import { type FC } from 'react'
import { Controller } from 'react-hook-form'
import { useAuthForm } from '../hooks/useAuthForm'

import { type IFormProps } from '@/shared/types/forms'
import { Input } from '@/shared/ui/Input'
import { Button } from '@/shared/ui/Button'

import styles from './auth.module.scss'

export const AuthForm: FC<IFormProps> = () => {
  const { control, handleSubmit, onSubmit, errors, isValid, isSubmitting, errorStatus, isLoading } =
    useAuthForm()

  return (
    <form className={styles.form} onSubmit={handleSubmit(onSubmit)}>
      <div className={styles.title}>
        <p>Авторизация</p>
      </div>

      {errorStatus === 401 && <span className={styles.error_auth}>Неверный логин или пароль</span>}

      <Controller
        name='user_name'
        control={control}
        render={({ field }) => (
          <Input
            id='user_name'
            label='Имя пользователя'
            hasResetIcon
            value={field.value}
            onChange={(text) => field.onChange(text)}
          />
        )}
      />
      <span className={styles.error_name}>{errors.user_name?.message}</span>

      <Controller
        name='password'
        control={control}
        render={({ field }) => (
          <Input
            id='password'
            label='Пароль'
            type='password'
            hasResetIcon
            value={field.value}
            onChange={(text) => field.onChange(text)}
          />
        )}
      />
      <span className={styles.error_pass}>{errors.password?.message}</span>

      <Button
        type='submit'
        label={isLoading ? 'Загрузка' : 'Войти'}
        mode='primary'
        className={styles.button}
        disabled={!isValid || isSubmitting}
      />
    </form>
  )
}
